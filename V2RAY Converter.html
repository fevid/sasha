<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>V2RAY Converter (Vmess Vless Trojan Shadowsocks) –¢–µ—Å—Ç–æ–≤—ã–π</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    * { font-weight: bold !important; }
    body { background: #121212; color: #eee; font-family: monospace; margin: 0; padding: 10px;
           display: flex; flex-direction: column; height: 100vh; box-sizing: border-box; }
    h2 { text-align: center; margin: 10px 0 20px; font-size: 1.2em; }
    .container { flex: 1; display: flex; flex-direction: column; gap: 10px; overflow: hidden; }
    .label { color: #bbb; font-size: 0.9em; margin-bottom: 4px; user-select: none; }
    textarea { width: 100%; height: 150px; background: #1e1e1e; color: #eee; padding: 10px;
               border-radius: 5px; resize: vertical; box-sizing: border-box; font-size: 14px;
               line-height: 1.3em; border: 3px solid; font-family: monospace; }
    #inputConfig { border-color: #28a745; }
    #outputResult { border-color: #dc3545; }
    .buttons-row { display: flex; width: 100%; gap: 10px; margin-top: 5px; }
    .buttons-left, .buttons-right { display: flex; flex-direction: column; gap: 10px; width: 50%; }
    .clear-row { margin-top: 10px; width: 100%; }
    .clear-row button { width: 100%; }
    button { color: #fff; padding: 10px 15px; border: none; cursor: pointer;
             border-radius: 5px; font-size: 14px; user-select: none; white-space: nowrap;
             transition: filter .2s ease; }
    #btnConvert { background: #28a745; }
    #btnConvertBack { background: #007bff; }
    #btnTextBase64 { background: #ff9800; }
    #btnClear { background: #dc3545; }
    #btnCopy, #btnDownload { background: #000; border: 2px solid #999; }
    #btnLoadFile { background: #6c757d; }
    button:hover { filter: brightness(1.2); }
    #fileInput { display: none; }

    /* –§–∏–ª—å—Ç—Ä */
    #filterRow { display: flex; gap: 10px; margin-bottom: 5px; position: relative; }
    #btnCountry {
      width: 36px; height: 36px; padding: 0;
      background: #007bff; border-radius: 5px;
      display: flex; align-items: center; justify-content: center;
      font-size: 18px;
    }
    #filterInput {
      flex: 1; height: 36px; padding: 0 10px; font-size: 14px;
      border: 3px solid #007bff; border-radius: 5px;
      background: #1e1e1e; color: #eee; box-sizing: border-box;
    }
    #btnFilter {
      background: #007bff; color: #fff; border: none; border-radius: 5px;
      padding: 0 15px; font-size: 14px; cursor: pointer;
      white-space: nowrap; transition: filter .2s ease;
    }
    #btnFilter:hover { filter: brightness(1.2); }

    /* –°–ø–∏—Å–æ–∫ —Å—Ç—Ä–∞–Ω */
    #countryPopup {
      position: absolute; top: 46px; left: 0;
      width: 50vw; max-width: calc(100% - 20px);
      height: calc(100vh - 160px); background: #1e1e1e;
      border: 3px solid #007bff; border-radius: 5px;
      overflow-y: auto; display: none; padding: 10px;
      box-sizing: border-box; z-index: 100;
    }
    #countryPopup #countrySearch {
      width: 100%; box-sizing: border-box; padding: 5px 10px;
      margin-bottom: 8px; font-size: 14px;
      border: 2px solid #007bff; border-radius: 5px;
      background: #121212; color: #eee;
    }
    #countryPopup .country-item {
      display: flex; align-items: center; padding: 5px 0; cursor: pointer;
    }
    #countryPopup .country-item:hover { background: #007bff22; }
    #countryPopup .country-item span {
      margin-left: 10px; color: #eee; font-size: 14px;
    }

    @media (max-width: 480px) {
      textarea { height: 130px; font-size: 13px; }
      .buttons-left button, .buttons-right button, #btnFilter, #btnCountry {
        font-size: 13px; padding: 8px 12px;
      }
      #filterInput { font-size: 13px; height: 32px; }
      #btnCountry { width: 32px; height: 32px; }
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/js-yaml@4/dist/js-yaml.min.js"></script>
</head>
<body>
  <h2>V2RAY Converter (Vmess Vless Trojan Shadowsocks) –¢–µ—Å—Ç–æ–≤—ã–π</h2>

  <div class="label">–§–∏–ª—å—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞</div>
  <div id="filterRow">
    <button id="btnCountry">üåé</button>
    <input id="filterInput" placeholder="–∫–ª—é—á–µ–≤–æ–π —Ç–µ–∫—Å—Ç –∏–ª–∏ —Ñ–ª–∞–≥..." />
    <button id="btnFilter">–æ–∫</button>
    <div id="countryPopup"></div>
  </div>

  <div class="container">
    <div>
      <div class="label">–ò—Å—Ö–æ–¥–Ω—ã–π JSON –∏–ª–∏ URL</div>
      <textarea id="inputConfig" placeholder="–í—Å—Ç–∞–≤—å –∫–æ–Ω—Ñ–∏–≥ –∏–ª–∏ —Å—Å—ã–ª–∫—É..."></textarea>
    </div>
    <div>
      <div class="label">–†–µ–∑—É–ª—å—Ç–∞—Ç</div>
      <textarea id="outputResult" placeholder="–†–µ–∑—É–ª—å—Ç–∞—Ç..."></textarea>
    </div>
    <div class="buttons-row">
      <div class="buttons-left">
        <button id="btnConvert">json ‚Üí url</button>
        <button id="btnConvertBack">url ‚Üí json</button>
        <button id="btnTextBase64">—Ç–µ–∫—Å—Ç ‚Üî base64</button>
      </div>
      <div class="buttons-right">
        <button id="btnCopy">—Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
        <button id="btnDownload">—Å–∫–∞—á–∞—Ç—å</button>
        <button id="btnLoadFile">–∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</button>
      </div>
    </div>
    <div class="clear-row">
      <button id="btnClear">–æ—á–∏—Å—Ç–∏—Ç—å</button>
    </div>
  </div>
  <input type="file" id="fileInput" accept=".txt,.json,.yaml,.yml">
  <a id="hiddenDownloadLink" style="display:none;"></a>

  <script>
    function extractAllJSON(text) {
      const res = [], stack = [], starts = [];
      for (let i = 0; i < text.length; i++) {
        if (text[i] === '{') { if (!stack.length) starts.push(i); stack.push('{'); }
        else if (text[i] === '}') {
          stack.pop();
          if (!stack.length && starts.length) {
            const start = starts.pop();
            try { res.push(JSON.parse(text.slice(start, i+1))); } catch {}
          }
        }
      }
      return res;
    }

    const countries = [
  { flag: 'üåé', name: 'OFF' },
  { flag: 'üá¶üá®', name: 'ASCENSION ISLAND' },
  { flag: 'üá¶üá©', name: 'ANDORRA' },
  { flag: 'üá¶üá™', name: 'UNITED ARAB EMIRATES' },
  { flag: 'üá¶üá´', name: 'AFGHANISTAN' },
  { flag: 'üá¶üá¨', name: 'ANTIGUA AND BARBUDA' },
  { flag: 'üá¶üáÆ', name: 'ANGUILLA' },
  { flag: 'üá¶üá±', name: 'ALBANIA' },
  { flag: 'üá¶üá≤', name: 'ARMENIA' },
  { flag: 'üá¶üá¥', name: 'ANGOLA' },
  { flag: 'üá¶üá∂', name: 'ANTARCTICA' },
  { flag: 'üá¶üá∑', name: 'ARGENTINA' },
  { flag: 'üá¶üá∏', name: 'AMERICAN SAMOA' },
  { flag: 'üá¶üáπ', name: 'AUSTRIA' },
  { flag: 'üá¶üá∫', name: 'AUSTRALIA' },
  { flag: 'üá¶üáº', name: 'ARUBA' },
  { flag: 'üá¶üáΩ', name: '√ÖLAND ISLANDS' },
  { flag: 'üá¶üáø', name: 'AZERBAIJAN' },
  { flag: 'üáßüá¶', name: 'BOSNIA AND HERZEGOVINA' },
  { flag: 'üáßüáß', name: 'BARBADOS' },
  { flag: 'üáßüá©', name: 'BANGLADESH' },
  { flag: 'üáßüá™', name: 'BELGIUM' },
  { flag: 'üáßüá´', name: 'BURKINA FASO' },
  { flag: 'üáßüá¨', name: 'BULGARIA' },
  { flag: 'üáßüá≠', name: 'BAHRAIN' },
  { flag: 'üáßüáÆ', name: 'BURUNDI' },
  { flag: 'üáßüáØ', name: 'BENIN' },
  { flag: 'üáßüá±', name: 'SAINT BARTH√âLEMY' },
  { flag: 'üáßüá≤', name: 'BERMUDA' },
  { flag: 'üáßüá≥', name: 'BRUNEI DARUSSALAM' },
  { flag: 'üáßüá¥', name: 'BOLIVIA (PLURINATIONAL STATE OF)' },
  { flag: 'üáßüá∂', name: 'BONAIRE, SINT EUSTATIUS AND SABA' },
  { flag: 'üáßüá∑', name: 'BRAZIL' },
  { flag: 'üáßüá∏', name: 'BAHAMAS' },
  { flag: 'üáßüáπ', name: 'BHUTAN' },
  { flag: 'üáßüáª', name: 'BOUVET ISLAND' },
  { flag: 'üáßüáº', name: 'BOTSWANA' },
  { flag: 'üáßüáæ', name: 'BELARUS' },
  { flag: 'üáßüáø', name: 'BELIZE' },
  { flag: 'üá®üá¶', name: 'CANADA' },
  { flag: 'üá®üá®', name: 'COCOS (KEELING) ISLANDS' },
  { flag: 'üá®üá©', name: 'CONGO, THE DEMOCRATIC REPUBLIC OF THE' },
  { flag: 'üá®üá´', name: 'CENTRAL AFRICAN REPUBLIC' },
  { flag: 'üá®üá¨', name: 'CONGO' },
  { flag: 'üá®üá≠', name: 'SWITZERLAND' },
  { flag: 'üá®üáÆ', name: "C√îTE D'IVOIRE" },
  { flag: 'üá®üá∞', name: 'COOK ISLANDS' },
  { flag: 'üá®üá±', name: 'CHILE' },
  { flag: 'üá®üá≤', name: 'CAMEROON' },
  { flag: 'üá®üá≥', name: 'CHINA' },
  { flag: 'üá®üá¥', name: 'COLOMBIA' },
  { flag: 'üá®üáµ', name: 'CLIPPERTON ISLAND' },
  { flag: 'üá®üá∑', name: 'COSTA RICA' },
  { flag: 'üá®üá∫', name: 'CUBA' },
  { flag: 'üá®üáª', name: 'CAPE VERDE' },
  { flag: 'üá®üáº', name: 'CURA√áAO' },
  { flag: 'üá®üáΩ', name: 'CHRISTMAS ISLAND' },
  { flag: 'üá®üáæ', name: 'CYPRUS' },
  { flag: 'üá®üáø', name: 'CZECHIA' },
  { flag: 'üá©üá™', name: 'GERMANY' },
  { flag: 'üá©üá¨', name: 'DIEGO GARCIA' },
  { flag: 'üá©üáØ', name: 'DJIBOUTI' },
  { flag: 'üá©üá∞', name: 'DENMARK' },
  { flag: 'üá©üá≤', name: 'DOMINICA' },
  { flag: 'üá©üá¥', name: 'DOMINICAN REPUBLIC' },
  { flag: 'üá©üáø', name: 'ALGERIA' },
  { flag: 'üá™üá®', name: 'ECUADOR' },
  { flag: 'üá™üá™', name: 'ESTONIA' },
  { flag: 'üá™üá¨', name: 'EGYPT' },
  { flag: 'üá™üá≠', name: 'WESTERN SAHARA' },
  { flag: 'üá™üá∑', name: 'ERITREA' },
  { flag: 'üá™üáπ', name: 'ETHIOPIA' },
  { flag: 'üá™üá∫', name: 'EUROPEAN UNION' },
  { flag: 'üá´üáÆ', name: 'FINLAND' },
  { flag: 'üá´üáØ', name: 'FIJI' },
  { flag: 'üá´üá∞', name: 'FALKLAND ISLANDS (MALVINAS)' },
  { flag: 'üá´üá≤', name: 'MICRONESIA (FEDERATED STATES OF)' },
  { flag: 'üá´üá¥', name: 'FAROE ISLANDS' },
  { flag: 'üá´üá∑', name: 'FRANCE' },
  { flag: 'üá¨üá¶', name: 'GABON' },
  { flag: 'üá¨üáß', name: 'UNITED KINGDOM' },
  { flag: 'üá¨üá©', name: 'GRENADA' },
  { flag: 'üá¨üá™', name: 'GEORGIA' },
  { flag: 'üá¨üá´', name: 'FRENCH GUIANA' },
  { flag: 'üá¨üá¨', name: 'GUERNSEY' },
  { flag: 'üá¨üá≠', name: 'GHANA' },
  { flag: 'üá¨üáÆ', name: 'GIBRALTAR' },
  { flag: 'üá¨üá±', name: 'GREENLAND' },
  { flag: 'üá¨üá≤', name: 'GAMBIA' },
  { flag: 'üá¨üá≥', name: 'GUINEA' },
  { flag: 'üá¨üáµ', name: 'GUADELOUPE' },
  { flag: 'üá¨üá∂', name: 'EQUATORIAL GUINEA' },
  { flag: 'üá¨üá∑', name: 'GREECE' },
  { flag: 'üá¨üá∏', name: 'SOUTH GEORGIA AND THE SOUTH SANDWICH ISLANDS' },
  { flag: 'üá¨üáπ', name: 'GUATEMALA' },
  { flag: 'üá¨üá∫', name: 'GUAM' },
  { flag: 'üá¨üáº', name: 'GUINEA-BISSAU' },
  { flag: 'üá¨üáæ', name: 'GUYANA' },
  { flag: 'üá≠üá∞', name: 'HONG KONG' },
  { flag: 'üá≠üá≤', name: 'HEARD ISLAND AND MCDONALD ISLANDS' },
  { flag: 'üá≠üá≥', name: 'HONDURAS' },
  { flag: 'üá≠üá∑', name: 'CROATIA' },
  { flag: 'üá≠üáπ', name: 'HAITI' },
  { flag: 'üá≠üá∫', name: 'HUNGARY' },
  { flag: 'üáÆüá®', name: 'CANARY ISLANDS' },
  { flag: 'üáÆüá©', name: 'INDONESIA' },
  { flag: 'üáÆüá™', name: 'IRELAND' },
  { flag: 'üáÆüá±', name: 'ISRAEL' },
  { flag: 'üáÆüá≤', name: 'ISLE OF MAN' },
  { flag: 'üáÆüá≥', name: 'INDIA' },
  { flag: 'üáÆüá¥', name: 'BRITISH INDIAN OCEAN TERRITORY' },
  { flag: 'üáÆüá∂', name: 'IRAQ' },
  { flag: 'üáÆüá∑', name: 'IRAN (ISLAMIC REPUBLIC OF)' },
  { flag: 'üáÆüá∏', name: 'ICELAND' },
  { flag: 'üáÆüáπ', name: 'ITALY' },
  { flag: 'üáØüá™', name: 'JERSEY' },
  { flag: 'üáØüá≤', name: 'JAMAICA' },
  { flag: 'üáØüá¥', name: 'JORDAN' },
  { flag: 'üáØüáµ', name: 'JAPAN' },
  { flag: 'üá∞üá™', name: 'KENYA' },
  { flag: 'üá∞üá¨', name: 'KYRGYZSTAN' },
  { flag: 'üá∞üá≠', name: 'CAMBODIA' },
  { flag: 'üá∞üáÆ', name: 'KIRIBATI' },
  { flag: 'üá∞üá≤', name: 'COMOROS' },
  { flag: 'üá∞üá≥', name: 'SAINT KITTS AND NEVIS' },
  { flag: 'üá∞üáµ', name: "KOREA (DEMOCRATIC PEOPLE'S REPUBLIC OF)" },
  { flag: 'üá∞üá∑', name: 'KOREA, REPUBLIC OF' },
  { flag: 'üá∞üáº', name: 'KUWAIT' },
  { flag: 'üá∞üáæ', name: 'CAYMAN ISLANDS' },
  { flag: 'üá∞üáø', name: 'KAZAKHSTAN' },
  { flag: 'üá±üá¶', name: "LAO PEOPLE'S DEMOCRATIC REPUBLIC" },
  { flag: 'üá±üáß', name: 'LEBANON' },
  { flag: 'üá±üá®', name: 'SAINT LUCIA' },
  { flag: 'üá±üáÆ', name: 'LIECHTENSTEIN' },
  { flag: 'üá±üá∞', name: 'SRI LANKA' },
  { flag: 'üá±üá∑', name: 'LIBERIA' },
  { flag: 'üá±üá∏', name: 'LESOTHO' },
  { flag: 'üá±üáπ', name: 'LITHUANIA' },
  { flag: 'üá±üá∫', name: 'LUXEMBOURG' },
  { flag: 'üá±üáª', name: 'LATVIA' },
  { flag: 'üá±üáæ', name: 'LIBYA' },
  { flag: 'üá≤üá¶', name: 'MOROCCO' },
  { flag: 'üá≤üá®', name: 'MONACO' },
  { flag: 'üá≤üá©', name: 'MOLDOVA, REPUBLIC OF' },
  { flag: 'üá≤üá™', name: 'MONTENEGRO' },
  { flag: 'üá≤üá´', name: 'SAINT MARTIN (FRENCH PART)' },
  { flag: 'üá≤üá¨', name: 'MADAGASCAR' },
  { flag: 'üá≤üá≠', name: 'MARSHALL ISLANDS' },
  { flag: 'üá≤üá∞', name: 'NORTH MACEDONIA' },
  { flag: 'üá≤üá±', name: 'MALI' },
  { flag: 'üá≤üá≤', name: 'MYANMAR' },
  { flag: 'üá≤üá≥', name: 'MONGOLIA' },
  { flag: 'üá≤üá¥', name: 'MACAO, SPECIAL ADMINISTRATIVE REGION OF CHINA' },
  { flag: 'üá≤üáµ', name: 'NORTHERN MARIANA ISLANDS' },
  { flag: 'üá≤üá∂', name: 'MARTINIQUE' },
  { flag: 'üá≤üá∑', name: 'MAURITANIA' },
  { flag: 'üá≤üá∏', name: 'MONTSERRAT' },
  { flag: 'üá≤üáπ', name: 'MALTA' },
  { flag: 'üá≤üá∫', name: 'MAURITIUS' },
  { flag: 'üá≤üáª', name: 'MALDIVES' },
  { flag: 'üá≤üáº', name: 'MALAWI' },
  { flag: 'üá≤üáΩ', name: 'MEXICO' },
  { flag: 'üá≤üáæ', name: 'MALAYSIA' },
  { flag: 'üá≤üáø', name: 'MOZAMBIQUE' },  
  { flag: 'üá≥üá¶', name: 'NAMIBIA' },
  { flag: 'üá≥üá®', name: 'NEW CALEDONIA' },
  { flag: 'üá≥üá™', name: 'NIGER' },
  { flag: 'üá≥üá´', name: 'NORFOLK ISLAND' },
  { flag: 'üá≥üá¨', name: 'NIGERIA' },
  { flag: 'üá≥üáÆ', name: 'NICARAGUA' },
  { flag: 'üá≥üá±', name: 'NETHERLANDS' },
  { flag: 'üá≥üá¥', name: 'NORWAY' },
  { flag: 'üá≥üáµ', name: 'NEPAL' },
  { flag: 'üá≥üá∑', name: 'NAURU' },
  { flag: 'üá≥üá∫', name: 'NIUE' },
  { flag: 'üá≥üáø', name: 'NEW ZEALAND' },
  { flag: 'üá¥üá≤', name: 'OMAN' },
  { flag: 'üáµüá¶', name: 'PANAMA' },
  { flag: 'üáµüá™', name: 'PERU' },
  { flag: 'üáµüá´', name: 'FRENCH POLYNESIA' },
  { flag: 'üáµüá¨', name: 'PAPUA NEW GUINEA' },
  { flag: 'üáµüá≠', name: 'PHILIPPINES' },
  { flag: 'üáµüá∞', name: 'PAKISTAN' },
  { flag: 'üáµüá±', name: 'POLAND' },
  { flag: 'üáµüá≤', name: 'SAINT PIERRE AND MIQUELON' },
  { flag: 'üáµüá≥', name: 'PITCAIRN' },  
  { flag: 'üáµüá∑', name: 'PUERTO RICO' },
  { flag: 'üáµüá∏', name: 'PALESTINE, STATE OF' },
  { flag: 'üáµüáπ', name: 'PORTUGAL' },
  { flag: 'üáµüáº', name: 'PALAU' },
  { flag: 'üáµüáæ', name: 'PARAGUAY' },
  { flag: 'üá∂üá¶', name: 'QATAR' },
  { flag: 'üá∑üá™', name: 'R√âUNION' },
  { flag: 'üá∑üá¥', name: 'ROMANIA' },
  { flag: 'üá∑üá∏', name: 'SERBIA' },
  { flag: 'üá∑üá∫', name: 'RUSSIAN FEDERATION' },
  { flag: 'üá∑üáº', name: 'RWANDA' },
  { flag: 'üá∏üá¶', name: 'SAUDI ARABIA' },
  { flag: 'üá∏üáß', name: 'SOLOMON ISLANDS' },
  { flag: 'üá∏üá®', name: 'SEYCHELLES' },
  { flag: 'üá∏üá©', name: 'SUDAN' },
  { flag: 'üá∏üá™', name: 'SWEDEN' },
  { flag: 'üá∏üá¨', name: 'SINGAPORE' },
  { flag: 'üá∏üá≠', name: 'SAINT HELENA, ASCENSION AND TRISTAN DA CUNHA' },
  { flag: 'üá∏üáÆ', name: 'SLOVENIA' },
  { flag: 'üá∏üáØ', name: 'SVALBARD AND JAN MAYEN' },
  { flag: 'üá∏üá∞', name: 'SLOVAKIA' },
  { flag: 'üá∏üá±', name: 'SIERRA LEONE' },
  { flag: 'üá∏üá≤', name: 'SAN MARINO' },
  { flag: 'üá∏üá≥', name: 'SENEGAL' },
  { flag: 'üá∏üá¥', name: 'SOMALIA' },
  { flag: 'üá∏üá∑', name: 'SURINAME' },
  { flag: 'üá∏üá∏', name: 'SOUTH SUDAN' },
  { flag: 'üá∏üáπ', name: 'SAO TOME AND PRINCIPE' },
  { flag: 'üá∏üáª', name: 'EL SALVADOR' },
  { flag: 'üá∏üáΩ', name: 'SINT MAARTEN (DUTCH PART)' },
  { flag: 'üá™üá¶', name: 'SPAIN' },
  { flag: 'üá™üá∏', name: 'SPAIN' },
  { flag: 'üá∏üáæ', name: 'SYRIA' },
  { flag: 'üá∏üáø', name: 'ESWATINI' },
  { flag: 'üáπüá¶', name: 'TRISTAN DA CUNHA' },
  { flag: 'üáπüá®', name: 'TURKS AND CAICOS ISLANDS' },
  { flag: 'üáπüá©', name: 'CHAD' },
  { flag: 'üáπüá´', name: 'FRENCH SOUTHERN TERRITORIES' },
  { flag: 'üáπüá¨', name: 'TOGO' },
  { flag: 'üáπüá≠', name: 'THAILAND' },
  { flag: 'üáπüáØ', name: 'TAJIKISTAN' },
  { flag: 'üáπüá∞', name: 'TOKELAU' },
  { flag: 'üáπüá±', name: 'TIMOR-LESTE' },
  { flag: 'üáπüá≤', name: 'TURKMENISTAN' },
  { flag: 'üáπüá≥', name: 'TUNISIA' },
  { flag: 'üáπüá¥', name: 'TONGA' },
  { flag: 'üáπüá∑', name: 'TURKEY' },
  { flag: 'üáπüáπ', name: 'TRINIDAD AND TOBAGO' },
  { flag: 'üáπüáª', name: 'TUVALU' },
  { flag: 'üáπüáº', name: 'TAIWAN' },
  { flag: 'üáπüáø', name: 'TANZANIA, UNITED REPUBLIC OF' },
  { flag: 'üá∫üá¶', name: 'UKRAINE' },
  { flag: 'üá∫üá¨', name: 'UGANDA' },
  { flag: 'üá∫üá≥', name: 'UNITED NATIONS' },
  { flag: 'üá∫üá∏', name: 'UNITED STATES OF AMERICA' },
  { flag: 'üá∫üáæ', name: 'URUGUAY' },
  { flag: 'üá∫üáø', name: 'UZBEKISTAN' },
  { flag: 'üáªüá¶', name: 'VATICAN CITY' },
  { flag: 'üáªüá®', name: 'SAINT VINCENT AND THE GRENADINES' },
  { flag: 'üáªüá™', name: 'VENEZUELA (BOLIVARIAN REPUBLIC OF)' },
  { flag: 'üáªüá¨', name: 'VIRGIN ISLANDS (BRITISH)' },
  { flag: 'üáªüáÆ', name: 'VIRGIN ISLANDS (U.S.)' },
  { flag: 'üáªüá≥', name: 'VIETNAM' },
  { flag: 'üáªüá∫', name: 'VANUATU' },
  { flag: 'üáºüá´', name: 'WALLIS AND FUTUNA' },
  { flag: 'üáºüá∏', name: 'SAMOA' },
  { flag: 'üáΩüá∞', name: 'KOSOVO' },
  { flag: 'üáæüá™', name: 'YEMEN' },
  { flag: 'üáæüáπ', name: 'MAYOTTE' },
  { flag: 'üáøüá¶', name: 'SOUTH AFRICA' },
  { flag: 'üáøüá≤', name: 'ZAMBIA' },
  { flag: 'üáøüáº', name: 'ZIMBABWE' },
  { flag: 'üè¥', name: 'BLACK FLAG' },
  { flag: 'üè¥‚Äç‚ò†Ô∏è', name: 'PIRATE FLAG' },
  { flag: 'üè¥‚Äç‚ò†', name: 'PIRATE FLAG ALTERNATIVE' }
];

    document.addEventListener('DOMContentLoaded', () => {
      const inEl    = document.getElementById('inputConfig');
      const outEl   = document.getElementById('outputResult');
      const fileInput  = document.getElementById('fileInput');
      const filterInput = document.getElementById('filterInput');
      const btnFilter   = document.getElementById('btnFilter');
      const btnCountry  = document.getElementById('btnCountry');
      const countryPopup= document.getElementById('countryPopup');
      let selectedCountry = 'OFF';

      // –ü–æ–ª–µ –ø–æ–∏—Å–∫–∞ –≤–Ω—É—Ç—Ä–∏ countryPopup
      const countrySearch = document.createElement('input');
      countrySearch.id = 'countrySearch';
      countrySearch.placeholder = '–ü–æ–∏—Å–∫ —Å—Ç—Ä–∞–Ω—ã‚Ä¶';
      countryPopup.appendChild(countrySearch);
      const itemsContainer = document.createElement('div');
      countryPopup.appendChild(itemsContainer);
      countrySearch.addEventListener('input', () => {
        const term = countrySearch.value.trim().toLowerCase();
        itemsContainer.querySelectorAll('.country-item').forEach(item => {
          item.style.display = item.dataset.name.toLowerCase().includes(term) ? 'flex' : 'none';
        });
      });
      // –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å—Ç—Ä–∞–Ω
      countries.forEach(c => {
        const item = document.createElement('div');
        item.className = 'country-item';
        item.innerHTML = `<span>${c.flag}</span><span>${c.name}</span>`;
        item.dataset.name = c.name;
        item.onclick = () => { selectedCountry = c.flag; btnCountry.textContent = c.flag; countryPopup.style.display = 'none'; };
        itemsContainer.appendChild(item);
      });
      btnCountry.addEventListener('click', e => {
        e.stopPropagation();
        const open = countryPopup.style.display === 'block';
        countryPopup.style.display = open ? 'none' : 'block';
        if (!open) {
          countrySearch.value = '';
          countrySearch.focus();
          itemsContainer.querySelectorAll('.country-item').forEach(i => i.style.display = 'flex');
        }
      });
      document.addEventListener('click', () => countryPopup.style.display = 'none');
      countryPopup.addEventListener('click', e => e.stopPropagation());

      // –ó–∞–≥—Ä—É–∑–∫–∞/–æ—á–∏—Å—Ç–∫–∞/–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ/—Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
      document.getElementById('btnLoadFile').onclick = () => fileInput.click();
      fileInput.onchange = e => {
        const fr = new FileReader();
        fr.onload = () => inEl.value = fr.result;
        fr.readAsText(e.target.files[0]);
      };
      document.getElementById('btnClear').onclick = () => { inEl.value = ''; outEl.value = ''; };
      document.getElementById('btnCopy').onclick = async () => { await navigator.clipboard.writeText(outEl.value); alert('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!'); };
      document.getElementById('btnDownload').onclick = () => {
        const data = outEl.value.trim();
        if (!data) return alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è');
        const link = document.getElementById('hiddenDownloadLink');
        link.href = URL.createObjectURL(new Blob([data], { type: 'text/plain' }));
        link.download = 'result.txt';
        link.click();
        setTimeout(() => URL.revokeObjectURL(link.href), 1000);
      };

      // Base64 ‚Üî —Ç–µ–∫—Å—Ç
      document.getElementById('btnTextBase64').onclick = () => {
        const txt = inEl.value.trim();
        if (!txt) { outEl.value = '–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ç–µ–∫—Å—Ç'; return; }
        try { outEl.value = decodeURIComponent(escape(atob(txt))); }
        catch { try { outEl.value = btoa(unescape(encodeURIComponent(txt))); } catch { outEl.value = btoa(txt); } }
      };

      // JSON ‚Üí URL –∏ Clash YAML ‚Üí URL
      document.getElementById('btnConvert').onclick = () => {
        const raw = inEl.value.trim();
        if (!raw) { outEl.value = '–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤–≤–æ–¥'; return; }
        // –°–Ω–∞—á–∞–ª–∞ –ø—ã—Ç–∞–µ–º—Å—è —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –∫–∞–∫ Clash YAML
        try {
          const cfg = jsyaml.load(raw);
          const proxies = cfg.proxies || [];
          if (proxies.length) {
            const urls = [];
            proxies.forEach(p => {
              const tag = encodeURIComponent(p.name || '');
              if (p.type === 'trojan') {
                urls.push(`trojan://${encodeURIComponent(p.password)}@${p.server}:${p.port}#${tag}`);
              } else if (p.type === 'vmess') {
                const qp = new URLSearchParams();
                qp.set('encryption', p.cipher || 'auto');
                qp.set('security', p.tls ? 'tls' : 'none');
                qp.set('type', p.network || '');
                if (p['ws-headers']?.Host) qp.set('host', p['ws-headers'].Host);
                if (p['ws-path']) qp.set('path', p['ws-path']);
                urls.push(`vmess://${p.uuid}@${p.server}:${p.port}?${qp.toString()}#${tag}`);
              } else if (p.type === 'shadowsocks') {
                const a = btoa(`${p.cipher}:${p.password}`).replace(/=+$/, '');
                urls.push(`ss://${a}@${p.server}:${p.port}#${tag}`);
              }
            });
            outEl.value = urls.join('\n') || '–Ω–µ –Ω–∞–π–¥–µ–Ω–æ proxies –≤ YAML';
            return;
          }
        } catch {}
        // –ò–Ω–∞—á–µ —Ä–∞–±–æ—Ç–∞–µ–º —Å JSON
        let rawJson = raw;
        const f = rawJson.indexOf('{'), l = rawJson.lastIndexOf('}');
        if (f !== -1 && l !== -1 && l > f) rawJson = rawJson.slice(f, l+1);
        if (!rawJson.trim()) { outEl.value = '–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç json'; return; }
        const all = extractAllJSON(rawJson), urls = [];
        all.forEach(obj => {
          if (obj.configType === 'VLESS' && obj.customConfig && obj.password && obj.server) {
            buildURLFromLegacy(obj, urls); return;
          }
          if (obj.outboundBean) { buildURLFromOutbound(obj.outboundBean, obj.remarks, urls); return; }
          if (obj.custom_json && Array.isArray(obj.custom_json.outbounds)) {
            buildURLsFromCustomJSON(obj, urls); return;
          }
          if (obj.server && obj.method && obj.password && obj.server_port) {
            const a = btoa(`${obj.method}:${obj.password}`).replace(/=+$/,'');
            let u = `ss://${a}@${obj.server}:${obj.server_port}`;
            if (obj.remarks) u += `#${encodeURIComponent(obj.remarks)}`;
            urls.push(u); return;
          }
          if (obj.configType==='VLESS' && obj.security==='reality' && obj.server) {
            const p = new URLSearchParams();
            p.set('encryption', obj.method||'none');
            p.set('security', obj.security);
            if (obj.flow) p.set('flow', obj.flow);
            if (obj.alpn) p.set('alpn', Array.isArray(obj.alpn)?obj.alpn.join(','):obj.alpn);
            p.set('allowInsecure', obj.insecure?'1':'0');
            p.set('type', obj.network||'');
            if (obj.sni) p.set('sni', obj.sni);
            if (obj.fingerPrint) p.set('fp', obj.fingerPrint);
            if (obj.publicKey) p.set('pbk', obj.publicKey);
            if (obj.shortId) p.set('sid', obj.shortId);
            const t = obj.remarks?encodeURIComponent(obj.remarks):'';
            urls.push(`vless://${obj.password}@${obj.server}:${obj.serverPort}?${p.toString()}#${t}`);
            return;
          }
          (obj.outbounds||obj.fullConfig?.outbounds||[]).forEach(o =>
            buildURLFromOutbound(o, obj.remarks, urls)
          );
        });
        outEl.value = urls.join('\n');
      };

      // URL ‚Üí JSON
      document.getElementById('btnConvertBack').onclick = () => {
        if (!inEl.value.trim()) { outEl.value = '–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç url'; return; }
        const lines = inEl.value.trim().split(/\r?\n/).filter(Boolean), arr = [];
        lines.forEach(line => {
          if (line.startsWith('ss://')) {
            const [main,hash] = line.slice(5).split('#'), tag = hash?decodeURIComponent(hash):'';
            const [auth,hp] = main.split('@'), [m,pw] = atob(auth).split(':');
            const [addr,port] = hp.split(':');
            arr.push({
              protocol:'shadowsocks', tag,
              settings:{servers:[{address:addr,port:+port,method:m,password:pw}]},
              streamSettings:{network:'tcp',security:'none',tcpSettings:{}}
            });
          } else {
            try {
              const u = new URL(line), proto = u.protocol.slice(0,-1), p = u.searchParams;
              const tag = decodeURIComponent(u.hash.slice(1))||proto;
              const typeParam = p.get('type')||'', headerType = p.get('headerType')||'';
              const h = p.get('host')||'', pat = p.get('path')||'';
              const ss = {
                network:typeParam==='xhttp'?'splithttp':typeParam,
                security:p.get('security')||'', packetEncoding:p.get('packetEncoding')||'',
                tlsSettings:{
                  serverName:p.get('sni')||'', fingerprint:p.get('fp')||'', allowInsecure:p.get('allowInsecure')==='1', alpn:p.get('alpn')?p.get('alpn').split(','):[]
                },
                realitySettings:{publicKey:p.get('pbk')||'', shortId:p.get('sid')||'', serverName:p.get('sni')||''},
                kcpSettings:{seed:p.get('seed')||''},
                grpcSettings:{serviceName:p.get('serviceName')||''}
              };
              if (headerType==='http'&&ss.network==='tcp') {
                ss.tcpSettings={header:{type:'http',request:{headers:{Host:[h]},path:[pat]}}};
              } else if (p.get('type')==='http') {
                ss.httpSettings={host:[h],path:pat};
              } else if (ss.network==='splithttp') {
                ss.splithttpSettings={host:h,path:pat}; ss.xhttpSettings={host:h,path:pat};
              } else if (ss.network==='httpupgrade') {
                ss.httpupgradeSettings={host:h,path:pat};
              } else if (ss.network==='ws'&&h) {
                ss.wsSettings={headers:{Host:h},path:pat};
              }
              if (proto==='vless') arr.push({
                protocol:'vless', tag,
                settings:{vnext:[{address:u.hostname,port:+u.port,users:[{id:u.username,encryption:p.get('encryption')||'none',flow:p.get('flow')||''}]}]},
                streamSettings:ss
              });
              if (proto==='vmess') arr.push({
                protocol:'vmess', tag,
                settings:{vnext:[{address:u.hostname,port:+u.port,users:[{id:u.username,security:p.get('encryption')||'auto'}]}]},
                streamSettings:ss
              });
              if (proto==='trojan') arr.push({
                protocol:'trojan', tag,
                settings:{servers:[{address:u.hostname,port:+u.port,password:decodeURIComponent(u.username)}]},
                streamSettings:ss
              });
            } catch {}
          }
        });
        const conf = {
          dns:{fallbackStrategy:'disabledIfAnyMatch',servers:[{address:'8.8.8.8',queryStrategy:'UseIP'}]},
          inbounds:[
            {listen:'0.0.0.0',port:10805,protocol:'socks',settings:{auth:'noauth',udp:true},tag:'sockets'},
            {listen:'0.0.0.0',port:1080,protocol:'http',settings:{allowTransparent:true},tag:'http'},
            {listen:'0.0.0.0',port:10804,protocol:'dokodemo-door',settings:{address:'0.0.0.0',network:'tcp,udp',port:10804},tag:'dns-in'}
          ],
          log:{loglevel:'warning'},
          outbounds:arr,
          policy:{levels:{'1':{connIdle:30}},system:{statsOutboundDownlink:true,statsOutboundUplink:true}},
          routing:{domainStrategy:'AsIs',rules:[{inboundTag:['dns-in'],outboundTag:'dns-out',type:'field'}]},
          stats:{}
        };
        outEl.value = JSON.stringify(conf,null,2);
      };

      // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è
      btnFilter.onclick = () => {
        const term = filterInput.value.trim().toLowerCase();
        const lines = inEl.value.split(/\r?\n/);
        outEl.value = lines.filter(l => {
          let dec;
          try { dec = decodeURIComponent(l); } catch { dec = l; }
          const mt = !term || dec.toLowerCase().includes(term) || l.toLowerCase().includes(term);
          const mc = selectedCountry==='OFF' || dec.includes(selectedCountry) || l.includes(selectedCountry);
          return mt && mc;
        }).map(l => {
          try { return decodeURIComponent(l); } catch { return l; }
        }).join('\n');
      };

      // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
      function buildURLFromLegacy(o, urls) {
        const p = new URLSearchParams();
        p.set('security', o.method || 'none');
        p.set('type', o.network || '');
        if (o.headerType) p.set('headerType', o.headerType);
        if (o.host) p.set('host', o.host);
        if (o.sni) p.set('sni', o.sni);
        if (o.path) p.set('path', o.path);
        if (o.alpn) p.set('alpn', Array.isArray(o.alpn)? o.alpn.join(',') : o.alpn);
        if (o.pbk) p.set('pbk', o.pbk);
        if (o.sid) p.set('sid', o.sid);
        p.set('allowInsecure', o.insecure ? '1' : '0');
        if (o.seed) p.set('seed', o.seed);
        if (o.serviceName) p.set('serviceName', o.serviceName);
        const tag = encodeURIComponent(o.remarks || o.customConfig.name || '');
        const base = `vless://${o.password}@${o.server}:${o.serverPort}`;
        urls.push(`${base}?${p.toString()}#${tag}`);
      }
      function buildURLsFromCustomJSON(obj, urls) { obj.custom_json.outbounds.forEach(o => buildURLFromOutbound(o, obj.remarks, urls)); }
      function buildURLFromOutbound(o, remarks, urls) {
        const proto = o.protocol, tag = encodeURIComponent(remarks||o.tag||proto), p = new URLSearchParams();
        let base = '';
        if (proto==='shadowsocks') {
          o.settings.servers.forEach(s => {
            const a = btoa(`${s.method}:${s.password}`).replace(/=+$/,'');
            urls.push(`ss://${a}@${s.address}:${s.port}#${tag}`);
          });
          return;
        }
        if (proto==='vmess'||proto==='vless') {
          const v = o.settings.vnext[0], u = v.users[0];
          base = `${proto}://${u.id}@${v.address}:${v.port}`;
          p.set('encryption',u.encryption||u.security||(proto==='vmess'?'auto':'none'));
          if (u.flow) p.set('flow',u.flow);
        }
        if (proto==='trojan') {
          const s = o.settings.servers[0];
          base = `trojan://${encodeURIComponent(s.password)}@${s.address}:${s.port}`;
        }
        if (!base) return;
        const s = o.streamSettings||{}, tls = s.tlsSettings||{}, rel = s.realitySettings||{};
        if (s.security) p.set('security',s.security);
        if (tls.allowInsecure) p.set('allowInsecure','1');
        if (Array.isArray(tls.alpn)) p.set('alpn',tls.alpn.join(','));
        if (tls.serverName) p.set('sni',tls.serverName);
        else if (rel.serverName) p.set('sni',rel.serverName);
        if (tls.fingerprint) p.set('fp',tls.fingerprint);
        if (rel.publicKey) p.set('pbk',rel.publicKey);
        if (rel.shortId) p.set('sid',rel.shortId);
        if (s.grpcSettings?.serviceName) p.set('serviceName',s.grpcSettings.serviceName);
        if (s.kcpSettings?.seed) p.set('seed',s.kcpSettings.seed);
        let net = s.network||'';
        if (!net) {
          if (s.wsSettings) net='ws';
          else if (s.httpupgradeSettings) net='httpupgrade';
          else if (s.splithttpSettings) net='splithttp';
          else if (s.httpSettings) net='http';
          else net='tcp';
        }
        if (net==='splithttp') net='xhttp';
        p.set('type',net);
        let host='', path='';
        if (net==='ws') { host = s.wsSettings.headers?.Host||''; path = s.wsSettings.path||''; }
        else if (net==='xhttp' && s.splithttpSettings) { host = s.splithttpSettings.host||''; path = s.splithttpSettings.path||''; }
        else if (net==='httpupgrade' && s.httpupgradeSettings) { host = Array.isArray(s.httpupgradeSettings.host)?s.httpupgradeSettings.host[0]:s.httpupgradeSettings.host||''; path = s.httpupgradeSettings.path||''; }
        else if (net==='http' && s.httpSettings) { host = Array.isArray(s.httpSettings.host)?s.httpSettings.host[0]:s.httpSettings.host||''; path = s.httpSettings.path||''; }
        else if (net==='tcp' && s.tcpSettings?.header?.type==='http') {
          const rq = s.tcpSettings.header.request;
          host = (rq.headers?.Host||[''])[0]||''; path = (rq.path||[''])[0]||'';
          p.set('headerType','http');
        }
        if (host) p.set('host',host);
        if (path) p.set('path',path);
        urls.push(`${base}?${p.toString()}#${tag}`);
      }
    });
  </script>
</body>
</html>